## 네트워크 보안 #7 주차

***

<br> 

### **스푸핑(Spoofing)**

- 속이다는 의미
- 인터넷이나 로컬에서 존재하는 모든 연결에 대해 스푸핑 가능
- 정보를 얻어내기 위한 중간 단계의 기술
- 시스템 마비



### **스푸핑 대비책**

- 관리하는 시스템 MAC 주소를 확인하여 테이블로 만들어 둔다.
- 브로드 캐스트 ping을 사용해서 응답하는 모든 시스템에 대한 MAC 주소 값을<br> 시스템 캐시에 기록
- arp -a 명령어로 현재 IP 주소 값과 MAC 주소의 대칭 값을 비교
  - 게이트웨이 MAC주소와 같은 MAC 주소로 매핑되어 있는지 확인



### **브로드 캐스트 종류**

- Directed Broadcast
  - 특정 네트워크 상의 호스트들에게 패킷 전송
  - 로컬 네트워크 상에 있지 않은 모든 호스트들에게 브로드캐스팅할 때 사용
- Local/Limited Broadcase
  - 로컬 네트워크 상의 호스트들로 제한된 통신하는 경우에 사용
  - 목적지 주소로 255.255.255.255를 사용



### **스푸핑 공격을 위한 IP와 MAC 주소 수집**

- **브로드캐스트 ping 보내기 - 리눅스**
  - **fping -a -g 192.168.0.1/24**
    - 192.168.0.1 : 로컬 네트워크의 게이트웨이 IP 주소
    - /24 : 네트워크 주소 범위
    - -a 옵션 : 활성화되어 있는 시스템 표시
    - -g 옵션 : 주소 범위
- **MAC 주소 확인하기**
  - arp -a
  - 게이트웨이 IP에 해당하는 로컬 네트워크의 IP와 MAC 주소 테이블 확인



### **ARP란?**

- ARP 테이블

  - LAN에 연결된 각 노드가 직접 관리하는 MAC 주소 매핑 테이블
  - 연결 대상 노드의 IP와 MAC 주소를 보관한다.
  - TTL : 할당 후 사용 가능 시간은 일반적으로 20분이다.

- ARP 동작 절차

  - 한 시스템에서 B의 IP가 포함된 ARP Request query를 브로드 캐스팅 한다.
    - 목적지 MAC 주소를 FF-FF-FF-FF-FF-FF로 세팅
    - 이 때 브로드 캐스팅 방식은 **Local/Limited Broadcast** 방식
  - 모든 시스템이 패킷을 받는다.
  - ARP Query에 담겨진 IP에 일치하는 시스템 이외 다른 시스템들은 해당 패킷을 폐기한다.
  - ARP Query에 담겨진 IP에 일치하는 시스템인 B는 해당 패킷을 수신 후 자신의<br> MAC 주소를 첨부하여 Request Query를 보냈던 시스템에게 ARP Reply 패킷으로 응답
  - 처음 Request Query를 방송했던 시스템은 B의 MAC 주소를 사용하여 B에 unicast로 전송
  - 처음 Request Query를 방송했던 시스템은 수신된 IP/MAC 주소 정보를 ARP 테이블에<br> TTL 시간 동안 유지
    - 일정 시간 후 내용이 사라지는 것을 Dynamic 이라 한다.
    - 반대로 사용자가 arp 테이블에 ip/mac 주소 정보를 채우는 것을 Static이라 한다.

  

### **ARP 스푸핑**

- **수행 환경**

  - LAN : 192.168.0 대역에서 진행
  - 게이트 웨이 : 192.168.0.1
  - 공격자 PC : 192.168.0.5(Kali Linux)
  - 피공격자 PC : 192.168.0.7(Windows 10)

- **진행 절차**

  - 공격자 PC에서 네트워크 연결 장치 상태 확인

  - 공격자 PC에서 네트워크에 연결된 장치들의 IP, MAC 주소 기록

    - 192.168.0. 로컬 네트워크에 브로드 캐스팅

    - 활성화되어 있는 시스템들을 출력해준다.

      > **fping -a -g 192.168.0.0/24**	

    - arp 테이블 확인

      > **arp -a**

  - 피공격자와 게이트웨이의 arp 캐쉬 테이블 변경 및 arp reply 패킷 전송

    - -i 옵션 : 로컬 네트워크에서 사용중인 랜 인터페이스 이름 명시

    - 피공격자 IP : 192.168.0.7

    - 게이트웨이 IP : 192.168.0.1

      > **arpspoof -i eth0 -t 192.168.0.7 192.168.0.1**

  - 피 공격자 PC의 arp 캐쉬 테이블 확인

    - 피공격자 PC와 같은 랜상에서 통신하는 게이트웨이와 공격자 IP, MAC 주소 정보 확인
    - 게이트웨이 MAC 주소와 공격자 PC의 MAC가 일치
    - 이때까지는 피공격자 PC에서 인터넷 접속 불가
      - 공격자 PC가 게이트웨이 서버로 중계 역할을 수행하지 않기 때문

  - 공격자 PC에서 fragrouter로 패킷 릴레이 수행

    - 피공격자 PC에서 인터넷 접속 요청 시

      - 공격자 PC에서 해당 패킷을 받아 게이트웨이로 전송

      - 게이트웨이에서는 응답 패킷을 공격자 PC로 전송

      - 공격자 PC는 피공격자 PC로 해당 응답 패킷을 전송

        > **fragrouter -B1**

      - 위 명령어 실행 이후로 피공격자 PC에서 인터넷 접속 가능

