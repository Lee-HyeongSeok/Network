## 네트워크 보안 #5 주차

***

<br> 

### **수동적/능동적 공격**

- 공격을 받고 있는데 공격을 받고있는줄 모르는 상태와 아는 상태

- **수동적 공격**
  - 공격을 받고 있는줄 모르는 상태
  - 자기 자신이 다른 사람의 공격을 인지하지 못하는 것
  - ex) 스니핑
- **능동적 공격**
  - 공격을 받고 있는 것을 인지하는 상태
  - 상대방의 공격을 인지하고 있는 것

### **풋프린팅(Footprinting)**

- 발자국을 살펴보는 일

- 공격 대상의 정보를 모으는 방법 중 하나

  - 침투하고자 하는 시스템의 사용자 계정

  - 사용자 정보, 계정 패스워드 정보

  - 기관, 회사의 게시판 이용

  - 협력사나 계열사 등의 보안 조치 확인

    - 리비히 최소량의 법칙

      > 식물의 성장을 좌우하는 것은 넘치는 영양소가 아닌, 가장<br> 부족한 영양소라는 것

      - 시스템을 이루는 보안의 요소 중 부족한 요소만큼 타격을 입는다.



### **사회 공학 기법(Social Engineering)**

- 친구끼리 사용자 계정이나 패스워드 정보를 주고 받거나, 패스워드를<br> 수첩이나 컴퓨터 옆에 적어 놓은 것들을 이용하는 해킹



### **스캔(Scan)**

- 서비스를 제공하는 서버의 작동 여부, 서버가 제공하는 서비스를 확인하기 위한 작업
- **ping**
  - 네트워크 상 연결된 두 개의 시스템이 정상 작동하는지 확인하는 유틸리티
  - TCP/IP 네트워크에서 **ICMP** 프로토콜을 사용
    - **Echo Request(Type 8)와 Echo Reply(Type 0) 이용**
    - Timestamp Request(Type 13)와 Information Reply(Type 16) 이용
    - Information Request(Type 15)와 Information Reply(Type 16) 이용
    - ICMP Address Mask Request(Type 17)와 ICMP Address Mask Reply(Type 18) 이용
- **ping 실행 결과**
  - ICMP 패킷 길이
    - Windows : 32Byte
    - Unix/Linux : 56Byte
  - 대상에서 보내온 ICMP Echo Reply 패킷 길이
  - TTL(Time To Live) 값
    - windows OS : 128
    - BSD OS : 64
    - Linux OS : 64
  - Request 패킷 개수, Reply 패킷 개수, 손실 패킷 개수
  - Request 전송 후 Reply까지 시간 정보
- **port 스캔**
  - 공격 대상 서버의 통신 포트가 열려있는지 여부를 조사
  - TCP, UDP 스캔 존재
  - **UDP 스캔**
    - 포트가 열린 경우
      - 아무런 응답이 없다.
    - 포트가 닫힌 경우
      - 대상이 ICMP Unreachable 패킷을 리턴한다.
  - **TCP 패킷을 이용한 스캔**
    - 응답이 일정하지 않다.
    - SYN 패킷을 이용한 스캔
      - 세션 성립을 위한 정당한 패킷과 구별 불가하기 때문에 효과적
    - 포트가 열린 경우
      - SYN(공격자에서 대상으로)
      - SYN+ACK(대상에서 공격자로)
      - ACK(공격자에서 대상으로)
    - 포트가 닫힌 경우
      - SYN(공격자에서 대상으로)
      - RST+ACK(대상에서 공격자로)
    - **스텔스(Stealth) 스캔**
      - 로그를 남기지 않는다.
      - 공격 대상을 속이고 자신의 위치를 숨긴다.
      - 대표적인 것이 TCP Half Open 스캔
      - **옵션**
        - FIN(finish) 스캔
          - 포트 open 상태일 때 응답 없음
          - 포트 close 상태일 때 RST 패킷 리턴
        - NULL 스캔
          - 플래그 값을 설정하지 않고 보낸 패킷
        - XMAX 스캔
          - FIN, PUSH, URG 플래그 모두를 설정한 패킷
      - 포트가 열린 경우
        - SYN(공격자에서 대상으로)
        - SYN+ACK(대상에서 공격자로)
        - RST(공격자에서 대상으로)
      - 포트가 닫힌 경우
        - SYN(공격자에서 대상으로)
        - RST+ACK(대상에서 공격자로)

### **TCP 포트 스캔을 이용한 공격**

- **TCP 단편화(Fragmentation) 공격**
  - 크기가 20Byte인 TCP 헤더를 2개의 분리된 패킷으로 나누어 보낸다.
    - 첫 번째 패킷 : 출발지, 도착지 IP주소만 포함
    - 두 번째 패킷 : 스캔하려는 포트 번호를 포함
  - 첫 번째 패킷 : TCP 포트에 대한 정보가 없어 방화벽 통과
  - 두 번째 패킷 : 출발지, 목적지 주소가 없어 방화벽 통과
- **시간차를 이용한 스캔**
  - 아주 짧은 시간 동안 많은 패킷을 보내는 방법
    - 방화벽과 IDS 처리 용량의 한계를 넘기는 방법
  - 아주 긴 시간 동안 패킷을 천천히 보내는 방법
- **FTP 바운스 스캔 또는 공격**
  - FTP 프로토콜 구조의 허점을 이용
  - FTP는 서버/클라이언트 구조로 이루어짐
  - 20, 21번 포트 사용
    - port 21 : 명령을 보내는데 사용하는 포트
    - port 20 : 데이터를 송수신 하는 포트
  - 데이터 수신시 FTP 클라이언트는 FTP 서버에게 클라이언트가 데이터를<br> 수신할 IP, Port 전달
  - FTP 서버는 전달 받은 IP, Port에 대해 점검없이 그대로 데이터 송신에 사용
    - 이 취약점을 이용하여 공격
    - 상대방의 IP주소와 포트를 서버에 전달하여 데이터를 송수신 하는 행위
- **ACK 패킷을 이용한 스캔**
  - 모든 포트에 ACK 패킷을 전송, 응답으로 돌아온 RST 패킷을 받아 분석
  - 포트가 열린 경우
    - TTL 값이 64 이하인 RST 패킷이 응답으로 리턴된다.
  - 포트가 닫힌 경우
    - 윈도우 크기가 0인 RST 패킷이 리턴된다.
    - TTL 값이 일정하게 큰 값



### **스캔 명령어**

- **fping을 이용한 스캔**

  - 스캔 전 네트워크 시스템 목록 확인시 사용

  - -a 옵션 : 활성화되어 있는 시스템을 출력

  - -q 옵션 : ICMP Request, ICMP Reply를 숨긴다.

  - -s 옵션 : 스캔 완료 후 결과를 정리해서 보여준다.

    > fping -q -a -s 192.168.0.0/24<br> 192.168.0 네트워크 주소에 있는 모든 활성화된 시스템 출력

- **nmap을 이용한 스캔**

  - -sT 옵션 : connect() 함수를 이용한 TCP Open 스캔

    > nmap -sT 192.168.0.1<br> 192.168.0.1의 열려있는 포트를 출력한다.

  - -sS 옵션 : SYN 스텔스 스캔

    - 세션을 성립시키지 않는다.

    > nmap -sS 192.168.0.1<br> 192.168.0.1의 열린 포트를 출력, 자신의 위치를 숨김

  - -p 옵션 : 특정 포트 스캔

    > nmap -sF -p 80, 443 192.168.0.1<br> 192.168.0.1의 80번, 443번 포트를 스캔

  - -sX : XMAS 패킷을 이용한 스캔

  - -sF : FIN 패킷을 이용한 스캔

  - -sN : NULL 패킷을 이용한 스캔

  - -O 옵션 : 시스템 운영체제를 추정하는 옵션

    > nmap -sS -p 21, 22, 53, 80 -O 192.168.0.7<br> 192.168.0.7 주소에 대해 21, 22, 53, 80번 포트가 열려있는지<br> 확인하고 주소에 해당하는 컴퓨터의 운영체제와 버전 추정한다.



### **운영체제 탐지**

- **배너 그래빙**

  - 상대 시스템의 OS를 확인하는 방법

  - 원격지 시스템에 로그인 시 뜨는 안내문과 비슷한 배너를 확인하는 기술

  - FTP 배너 그래빙

    > #telnet 192.168.0.2 21	(21은 ftp 포트)

    > #ftp 192.168.0.2	(ftp 접속 명령어)

  - SMTP 포트 배너 그래빙

    > #telnet 192.168.0.2 25	(25는 SMTP 포트)

  - ssh 포트 배너 그래빙

    > #telnet 127.0.0.1 22	(22는 ssh 포트)

  - POP3 포트 배너 그래빙

    > #telnet 127.0.0.1 110	(110은 POP3 포트)

  - IMAP4 포트 배너 그래빙

    > #telnet 127.0.0.1 143	(143은 IMAP4 포트)

  - 웹 서버 포트 배너 그래빙

    > #telnet 192.168.0.1 80	(80은 웹 서버 포트)



### **넷크래프트**

- 공격 대상에 대한 다양한 정보를 보여준다.



### **방화벽**

- 접속에 대한 허용, 차단 결정
- 방화벽 설치 여부 확인 -> traceroute
  - 실행 시 *만으로 표시되는 곳이 라우팅에서 필터링 해주고 있거나<br> 방화벽이 존재하는 것

### **침입 탐지 시스템(IDS, Instrusion Detection System)**

- 방화벽이 막을 수 없거나 차단에 실패한 공격 탐지
- 관리자에게 보고



### **SNMP(Simple Network Management Protocol)**

- 중앙 집중적인 관리 툴의 표준 프로토콜
- **구성 요소**
  - 관리 시스템, 관리 대상으로 나뉜다.
  - 관리 대상 구성
    - SNMP : 전송 프로토콜
    - MIB : 관리할 개체의 집합
    - SMI : 표준에 적합한 MIB 생성, 관리하는 기준
  - 관리 시스템과 에이전트 통신의 최소 일치 사항
- **취약점**
  - 기본적으로 누구라도 SNMP의 MIB 정보 확인 가능
  - 패킷이 UDP로 전송되어 연결 신뢰도 낮음
  - 데이터 미암호화, 스니핑 가능
- **취약점 대책**
  - 상황에 따라 SNMP 사용 막음
  - 커뮤니티를 패스워드처럼 복잡하게 설정
  - SNMP를 사용할 시스템의 IP 등록