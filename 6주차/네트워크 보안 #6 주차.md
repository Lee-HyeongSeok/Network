## 네트워크 보안 #6 주차

***

<br> 

### **스니핑**

- 수동적 공격 중 하나
- 코를 킁킁거리다라는 의미
- 희생자가 공격 당하고 있음을 인지하지 못한다.
- 도청과 엿듣기



### **혼잡모드(프러미스큐어스 모드, Promiscuous Mode)**

- MAC 주소와 IP 주소에 관계없이 모든 패킷을 스니퍼에게 넘겨주는 것
- 랜 카드에 대한 모드 설정 가능
- 리눅스에서 설정
  - ifconfig로 랜 카드 확인하기 ex) eth0
  - ifconfig eth0 promisc 명령어로 프러미스큐어스 모드 on
  - ifconfig로 RUNNING PROMISC 실행 중임을 확인



### **바이패스 모드(Bypass Mode)**

- 패킷에 대한 분석까지 HW로 구현되어 있는 랜 카드
- 기가바이트 단위의 백본망에서 스니핑을 하기 위한 장비



### **tcpdump**

- 스니핑 툴
- 처음에는 네트워크 관리를 위해 개발
- 획득한 증거 자료는 법적 효력이 있음
- CLI 환경에서 동작
- **옵션**
  - -i device : 랜 카드 인터페이스 결정
  - -w : 캡처한 패킷들을 파일에 저장(write)
  - -c number : 지정한 수의 패킷을 받은 후 종료
  - -s length : 68byte 이외의 값으로 설정
- **사용 예시**
  - #tcpdump -i eth0 -x host 192.168.0.2
    - -x : 각 패킷을 Hex코드로 출력
    - 설정한 인터페이스는 eth0
  - 원격지 텔넷 서버로 접속
    - telnet 192.168.0.2
  - 계정, 패스워드 평문 전달



### **Fragrouter**

- 공격자가 스니핑하거나 세션을 가로챘을 때 외부에서 공격자에게 온<br> 패킷을 정상적으로 수신자에게 전달하려면 패킷 릴레이 필요
- 스니핑 보조 툴
- 패킷 릴레이 역할 수행



### **DSniff**

- 스니핑을 위한 다양한 툴이 패키징되어 있음
- 암호화된 계정, 패스워드 읽기 가능



### **스위치**

- 각 장비의 MAC 주소 확인 -> 포트에 할당
- 루프백 패킷 외에는 받을 수 없어서 스니핑 공격이 차단된다.
- **스위칭 환경**
  - SPAN(Switch Port Analyzer)
    - 스위치에서 각 포트에 송수신되는 모든 데이터를 모니터링 하는 미러링 포트
    - 주로 IDS를 연결할 사용하는 포트
    - SPAN 사용시 스위치에서도 스니핑 가능
  - 태핑(= 스플리터, Splitter)
    - 스위치에서 SPAN 사용시 발생하는 성능저하를 해결하는 장치
    - 포트 모니터링을 위한 분기 장비



### **ARP**

- IP 주소를 MAC 주소로 변환하는 프로토콜
- ARP Redirect
  - 기존 라우터의 MAC 주소를 알아내서 공격 대상에게 자신의 MAC 주소가<br> 라우터인 것처럼 속이기 위해 주기적으로 브로드캐스트
  - 공격 대상으로부터 수신되는 패킷을 스니핑
  - 브로드 캐스팅으로 인해 네트워크 내 모든 호스트가 공격 대상
- ARP 스푸핑
  - 공격자가 공격 대상 MAC 주소를 안다.
  - 공격 대상의 ARP 테이블 변경
  - 공격 대상이 공격자에게 패킷을 보내도록 유도
  - 호스트 대 호스트 공격 가능

### **ICMP 리다이렉트**

- 하나의 라우터로 네트워크 부하를 감당할 수 없을 때 라우터나 게이트웨이를<br> 두 개 이상 구축
- 장치들 간에 로드밸런싱(부하분산 기능) 구현



### **ICMP 리다이렉트 공격**

- 호스트가 외부 서버에 접속 요청하기 위해 자체 라우팅 테이블 확인
- 호스트가 라우터에 패킷 전송
- 라우터는 외부 웹 서버 접속 요청에 대한 패킷 확인
- 이때, 로드 밸런싱을 위해서 또 다른 라우터에 패킷을 전송하도록 호스트에<br> ICMP 리다이렉트 패킷 전송
- 호스트는 ICMP 리다이렉트 패킷 수신 후 라우팅 테이블 추가/변경
- 호스트는 수정된 라우팅 테이블 참조, 리다이렉트 대상 라우터를 경유하여 외부접속
- **공격 원리**
  - 공격자는 공격자 네트워크에 또 다른 라우터로 가장
  - 또 다른 라우터라는 허위 정보를 같은 네트워크에 모든 호스트에 전송
  - 정보 수신자는 특정 호스트 접속시 공격자 시스템을 경유하게 된다.
  - 공격자는 패킷 스니핑 진행


### **ARP 스푸핑과 ICMP Redirect 차이**

- ARP 스푸핑 : 특정 호스트의 모든 트래픽에 대한 리다이렉트 가능
- ICMP 리다이렉트 : 특정 호스트의 목적지 주소를 가진 패킷만 선별적으로 리다이렉트함



### **스위치 재밍**

- 스위치를 직접 공격
- MAC 테이블을 위한 캐시 공간에 버퍼 오버플로 공격 수행 
- macof 명령으로 스위치 재밍 



### **스니핑 탐지**

- **능동적 대응책**
  - **ping을 이용한 탐지**
    - 의심 호스트에 네트워크에 존재하지 않는 MAC주소로 위장하여 ping 전송
    - ICMP Echo Reply를 받으면 해당 호스트가 Promisc 모드로 동작 중임
  - **ARP를 이용한 탐지**
    - 위조된 ARP Request를 스니핑 중인 시스템에 보낸다.
    - 대상 시스템이 ARP Response를 보내면 Promisc 모드로 동작 중인 스니퍼로 확인
  - **DNS를 이용한 탐지**
  - 대상 네트워크로 Ping Sweep을 보내고 들어오는 Reverse-DNS lookup 감시
  - **Ping Sweep**
    - 공격자가 대상 네트워크에 어떤 서버가 존재하는지 파악
    - ICMP를 이용하여 대상 네트워크의 브로드 캐스트 IP 입력
    - 다음 응답되는 패킷을 분석
- **수동적 대응책 - 암호화**
  - SSL
    - 암호화된 웹서핑 가능
  - PGP, PEM, S/MIME
    - 이메일 전송시 사용하는 암호화 방법
  - VPN
    - 한 회선을 여러 회사가 공유
    - 암호화된 트래픽 제공

