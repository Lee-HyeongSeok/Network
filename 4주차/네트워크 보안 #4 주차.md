## 네트워크 보안 #4 주차

***

<br> 

### **IP 주소 추적**

- **기본**
  - 출발지 IP 주소 확인하기

- **메일 이용**
  - 1차 메일 서버 정보
    - 목적지로 전송하기 위해 서버에 메일을 저장하는 단계에 대한 정보
  - 2차 메일 서버 정보
    - **Received-SPF**
    - 주요 메일 서버와 IP 등록
    - 메일이 전송된 서버의 IP와 메일 주소를 확인 -> 스팸 여부 검사 결과 표시
    - Pass 값일 때
      - 메일 헤더가 위 변조되지 않았음
      - 발신자가 메일에 대한 책임을 가진 도메인임을 나타낸다.
    - Fail 값일 때
      - 메일 헤더가 위 변조되었음
      - 메일을 송신한 메일 서버의 IP와 도메인 불일치 의미
    - **SPF(Sender Policy Framework)**
      - 메일 서버 정보를 사전에 DNS에 공개 등록
      - 수신자 이메일에 표시된 발신자 정보가 실제 메일 서버의 정보와 일치성을<br> 확인하는 인증기술
  - 3차 메일 서버 정보
  - 4차 메일 서버 정보
- **P2P 서비스 이용**
  - 카카오톡, 스카이프, 토렌트와 같은 파일 공유 프로그램 등
  - Peer to Peer, 당사자 간의 통신 특성 때문에 p2p 이용 사용자의 ip 정보 노출 가능성 있음
  - **IP가 노출되지 않는 경우**
    - 일반적인 텍스트 교환 형태의 정보 교환
  - **IP가 노출되는 경우**
    - 사용자 간의 직접 통신이 이루어질 때
      - 많은 양의 데이터 전송이 필요한 상황
      - 인터넷 전화 서비스를 이용하는 경우
- **웹 해킹 공격**
  - APT(Advanced Persistent Threat) 공격, 웹 페이지 취약점을 이용
  - 해커는 웹 사이트의 구조 파악 -> 웹 게시판 접근
  - 서비스 로그 분석 -> 해커의 IP 확인 가능
- **traceroute**
  - 윈도우 : tracert 명령어 수행
  - 리눅스 : traceroute 명령어 수행
  - 패킷이 목적지까지 도달하는 동안 경유하는 라우터의 ip를 확인
  - 상대 IP를 알고 있는 상태, 상대가 속한 인터넷 구성 추정 가능
  - 수행할 때 경로가 매번 다르다가 하나로 고정되면 역추적 당하는 걸수도있음
  - UDP의 ICMP, IP의 TTL 값 이용
    - ICMP time exceed : TTL 값 변경 모니터링
      - TTL 값이 0에 도달했을 때
    - ICMP port unreachable : 목적지 호스트에 임의의 UDP port 존재 여부 모니터링
      - 목적지 시스템의 특정 포트가 응답 불가한 경우



### **전자 메일**

- SMTP
- POP3
- IMAP



### **전자 메일 3요소**

- 사용자 에이전트
  - 메일 read 프로그램
  - 메일 작성, 전송, 수신, 읽기 기능 제공
  - 송수신 메시지는 메일 서버에 저장
- 메일 서버
  - mailbox, message queue, SMTP 프로토콜로 구성
  - mailbox : 사용자에 전달할 수신 메시지 보관
  - message queue : 외부 사용자에게 전송할 메시지 보관
- SMTP 메일 전송 프로토콜(25번 포트 사용)
  - 메일 서버 간에 메일 전송 프로토콜
  - TCP 프로토콜 사용(지속적인 커넥션 사용)
  - 전송 3단계 : 핸드 셰이킹 - 메시지 전송(반드시 7비트 아스키만 사용) - 연결 종료
  - 클라이언트(메일 사용자) / 서버(메일 중개자)



### **SMTP 특징**

- TCP 프로토콜을 이용한 지속적인 커넥션
- 메시지에 7bit ASCII만 사용 가능
- push용 프로토콜
  - 클라이언트는 서버에 대한 연결을 열고 지속적으로 활성 상태 유지
  - 서버는 모든 새 이벤트를 클라이언트에 전송(push)



### **Push & Pull 방식**

- **push 방식**
  - SMTP에서 사용(서버간 메일 전송, 전송을 밀어 넣는다)
  - 클라이언트는 서버에 대한 연결을 지속적으로 활성 상태 유지
  - 서버는 모든 새 이벤트를 클라이언트에 전송
- **pull 방식**
  - 메일 접근 프로토콜에서 사용(서버로부터 회수)
    - POP3
    - IMAP
    - HTTP : gmail, hotmail 등
      - 1.0 : 연결-전송-종료의 반복
      - 1.1 : 지속적인 연결 - 전송 - 종료
  - 클라이언트는 웹 브라우저를 통해 서버의 jsp 파일을 요청하여 받아온다(pull, 당기다)
  - 클라이언트는 주기적으로 서버에 연결, 최근 이벤트를 확인하고 가져와서 <br> 연결을 닫고 서버와의 연결을 끊는다.
  - 클라이언트는 주기적으로 서버에서 새 이벤트를 pull한다.



### **HTTP와 SMTP 차이**

- 메시지 전송
  - SMTP : 여러 객체가 여러 개의 메시지로 전송됨
  - HTTP : 각 객체는 응답 메시지 속에 캡슐화 됨
- 전송 프로토콜
  - SMTP(PUSH 방식) : 서버의 모든 새 이벤트를 클라이언트에 전송
  - HTTP(PULL 방식) : 클라이언트는 주기적으로 서버에서 새 이벤트는 pull



### **메일 접근 프로토콜 POP3 & IMAP 차이**

- **POP3**
  - 클라이언트가 메일 다운로드 시 서버에서 자동 삭제
    - **로컬 PC에 메일이 저장되기 때문**
  - 클라이언트가 메시지 저장 및 보관
  - 세션 간 상태 저장 불가
- **IMAP**
  - 클라이언트가 메일 다운로드 해도 서버에서 삭제되지 않는다.
    - **메일 서버에 저장되기 때문**
  - 서버에 모든 메시지 저장
  - 사용자가 폴더 지정, 분류 저장 가능
  - 세션 중 연결 상태 저장 가능(폴더 및 파일의 안정적인 관리 가능)

### **전자 메일 메시지 전송 과정**

- A는 User Agent를 사용, 목적지 이메일로 보내는 메시지 생성
- A의 User Agent는 등록된 메일 서버로 메시지 전송
  - A의 메시지는 메일 서버의 큐에 등록된다.
- A의 메시지를 가진 메일 서버는 B의 메일 서버와 TCP 연결 시도
  - 3 - Way - Handshaking
- 연결 이후 SMTP 프로토콜을 이용하여 A의 메시지를 B의 메일 서버로 전송
- B의 메일 서버는 B의 mailbox에 저장
- B는 자신의 UX를 사용, 수신된 메시지를 읽는다.



### **로그 관리 AAA**

- Authentication(인증)
  - 자신의 신원을 시스템에 증명하는 과정
  - 아이디와 패스워드를 입력하는 과정
- Authorization(인가)
  - 올바른 지문, 패스워드를 입력해 시스템에 로그인이 허락된 사용자라<br>판명되어 로그인되는 과정
- Accounting
  - 시스템에 로그인 후 시스템이 이에 대한 기록을 남기는 활동



### **유닉스의 로그**

- UTMP
  - 바이너리 형태로 로그 저장
  - w 명령어를 이용하여 확인
- UTMP로 확인 가능한 목록
  - 로그인 계정 이름
  - 로그인 환경
  - 로그인한 디바이스
  - 로그인한 쉘의 프로세스 ID
  - 로그인한 계정의 형식
  - 로그오프 여부
  - 시간에 대한 저장 구조
- WTMP
  - utmp 데몬과 비슷하게 사용자들의 로그인, 로그아웃, 시스템 재부팅에<br> 대한 정보를 담고 있음
  - last 명령어를 이용하여 확인
- su 로그
  - /var/adm/sulog 파일에 텍스트 형식으로 남음
- syslog
  - 시스템의 운영과 관련한 전반적인 로그
  - /var/log/messages 파일에 남김
  - 하드웨어의 구동, 서비스 동작, 에러 등



### **DB의 로그 관리**

- 로그인 감사
- C2 감사 추적
  - DB의 CRUD에 대한 자세한 정보를 로그로 남기는 것



### **네트워크 장비 로그 관리**

- 네트워크 장비(라우터, 스위치)에는 디스크가 없는데 로그를 어떻게 관리할까?
  - 서버를 통해서 관리
  - 각 네트워크 장비에서 생성되는 로그를 네트워크를 통해 로그 서버에 전송
- **네트워크 장비의 로그 관리**
  - 네트워크 **보안 시스템**의 로그
    - 다양한 보안 시스템의 로그 확인 가능
    - 통합로그관리시스템(SIEM)에 의해 수집, 관리
  - 네트워크 **관리 시스템**의 로그
    - 네트워크 트래픽 모니터링 시스템(MRTG)
    - 네트워크 관리 시스템(NMS)의 로그 참조 가능
  - 네트워크 **장비 인증 시스템**의 로그
    - 대규모 네트워크를 운영하는 곳에서 사용
    - 라우터나 스위치의 인증을 일원화하기 위해 사용
      - TACACS 인증 서버를 사용
      - 네트워크 장비에 대한 인증 시도 및 로그인 정보 등 확인 가능

